{"version":3,"file":"viewport.min.js","sources":["../../src/index.ts"],"sourcesContent":["const store = {\n    docInfo: {}\n};\nfunction init(options = {}) {\n    if (!window) {\n        console.warn('viewport startup time is incorrect.');\n        return;\n    }\n    let { width = 375, mobile = true, fontSize = mobile ? \"0.16rem\" : \"16rem\", metaViewport = true, userScalable = \"no\", initialScale = \"1.0\", minimumScale = null, maximumScale = null } = options;\n    store.options = { width, mobile, fontSize, metaViewport, userScalable, initialScale, minimumScale, maximumScale };\n    /* 插入viewport标签 */\n    if (metaViewport) {\n        let meta = document.createElement(\"meta\");\n        meta.setAttribute(\"name\", \"viewport\");\n        let metaContent = [\"width=device-width\"];\n        if (userScalable !== null)\n            metaContent.push(\"user-scalable=\" + userScalable);\n        if (initialScale !== null)\n            metaContent.push(\"initial-scale=\" + initialScale);\n        if (minimumScale !== null)\n            metaContent.push(\"minimum-scale\" + minimumScale);\n        if (maximumScale !== null)\n            metaContent.push(\"maximum-scale=\" + maximumScale);\n        meta.setAttribute(\"content\", metaContent.join(\",\"));\n        let head = document.getElementsByTagName(\"head\")[0];\n        let oldvp = document.querySelector(`meta[name=\"viewport\"]`);\n        if (oldvp) {\n            head.insertBefore(meta, oldvp);\n            head.removeChild(oldvp);\n        }\n        else {\n            let first = head.firstChild;\n            head.insertBefore(meta, first);\n        }\n        store.docInfo.meta = meta;\n    }\n    /* 根据页面改变计算rem */\n    let resizeEvt = 'onorientationchange' in window ? 'orientationchange' : 'resize';\n    function recalc() {\n        let docEl = document.documentElement;\n        let { clientWidth } = docEl;\n        if (!clientWidth)\n            return;\n        let pro = clientWidth / width;\n        let rootSize = Number(mobile ? pro * 100 : pro).toFixed(4);\n        docEl.style.fontSize = rootSize + \"px\";\n        store.docInfo.rootSize = rootSize;\n    }\n    window.addEventListener(resizeEvt, recalc);\n    /* 还原系统默认字体大小 */\n    function resetSize() {\n        document.body.style.fontSize = fontSize;\n    }\n    recalc();\n    let observer = new MutationObserver((list) => {\n        if (document.body) {\n            resetSize();\n            observer.disconnect();\n        }\n    });\n    observer.observe(document.documentElement, { childList: true });\n}\nexport default {\n    init,\n    get info() {\n        return store;\n    }\n};\n//# sourceMappingURL=index.js.map"],"names":["store","docInfo","index","init","options","window","console","warn","width","mobile","fontSize","metaViewport","userScalable","initialScale","minimumScale","maximumScale","meta","document","createElement","setAttribute","metaContent","push","join","head","getElementsByTagName","oldvp","querySelector","insertBefore","removeChild","first","firstChild","resizeEvt","recalc","docEl","documentElement","clientWidth","pro","rootSize","Number","toFixed","style","addEventListener","observer","MutationObserver","list","body","disconnect","observe","childList","info"],"mappings":"AAAA,MAAMA,EAAQ,CACVC,QAAS,CAAE,GA6Df,IAAeC,EAAA,CACXC,KA5DJ,SAAcC,EAAU,IACpB,IAAKC,OAED,YADAC,QAAQC,KAAK,uCAGjB,IAAIC,MAAEA,EAAQ,IAAGC,OAAEA,GAAS,EAAIC,SAAEA,GAAWD,EAAS,UAAY,SAAOE,aAAEA,GAAe,EAAIC,aAAEA,EAAe,KAAIC,aAAEA,EAAe,MAAKC,aAAEA,EAAe,KAAIC,aAAEA,EAAe,MAASX,EAGxL,GAFAJ,EAAMI,QAAU,CAAEI,QAAOC,SAAQC,WAAUC,eAAcC,eAAcC,eAAcC,eAAcC,gBAE/FJ,EAAc,CACd,IAAIK,EAAOC,SAASC,cAAc,QAClCF,EAAKG,aAAa,OAAQ,YAC1B,IAAIC,EAAc,CAAC,sBACE,OAAjBR,GACAQ,EAAYC,KAAK,iBAAmBT,GACnB,OAAjBC,GACAO,EAAYC,KAAK,iBAAmBR,GACnB,OAAjBC,GACAM,EAAYC,KAAK,gBAAkBP,GAClB,OAAjBC,GACAK,EAAYC,KAAK,iBAAmBN,GACxCC,EAAKG,aAAa,UAAWC,EAAYE,KAAK,MAC9C,IAAIC,EAAON,SAASO,qBAAqB,QAAQ,GAC7CC,EAAQR,SAASS,cAAc,yBACnC,GAAID,EACAF,EAAKI,aAAaX,EAAMS,GACxBF,EAAKK,YAAYH,OAEhB,CACD,IAAII,EAAQN,EAAKO,WACjBP,EAAKI,aAAaX,EAAMa,EAC3B,CACD7B,EAAMC,QAAQe,KAAOA,CACxB,CAED,IAAIe,EAAY,wBAAyB1B,OAAS,oBAAsB,SACxE,SAAS2B,IACL,IAAIC,EAAQhB,SAASiB,iBACjBC,YAAEA,GAAgBF,EACtB,IAAKE,EACD,OACJ,IAAIC,EAAMD,EAAc3B,EACpB6B,EAAWC,OAAO7B,EAAe,IAAN2B,EAAYA,GAAKG,QAAQ,GACxDN,EAAMO,MAAM9B,SAAW2B,EAAW,KAClCrC,EAAMC,QAAQoC,SAAWA,CAC5B,CACDhC,OAAOoC,iBAAiBV,EAAWC,GAKnCA,IACA,IAAIU,EAAW,IAAIC,kBAAkBC,IAC7B3B,SAAS4B,OAJb5B,SAAS4B,KAAKL,MAAM9B,SAAWA,EAM3BgC,EAASI,aACZ,IAELJ,EAASK,QAAQ9B,SAASiB,gBAAiB,CAAEc,WAAW,GAC5D,EAGI,QAAIC,GACA,OAAOjD,CACV"}